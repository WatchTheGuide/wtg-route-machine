<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta
      name="description"
      content="GuideTrackee Routes - Aplikacja do planowania tras pieszych, rowerowych i samochodowych w miastach Polski" />
    <meta name="theme-color" content="#ff6600" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="GuideTrackee" />

    <!-- iOS Icons -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="assets/icons/icon-180.png" />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="assets/icons/icon-152.png" />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="assets/icons/icon-120.png" />

    <!-- Android Icons -->
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="assets/icons/icon-192.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="assets/icons/icon-512.png" />

    <title>GuideTrackee Routes - City Walking Tours</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#ff6600',
              'primary-dark': '#cc5200',
              'primary-light': '#ff8533',
              secondary: '#454545',
              'secondary-light': '#6b6b6b',
            },
          },
        },
      };
    </script>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- pdfMake for PDF export with full UTF-8 support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.min.js"></script>

    <!-- OpenLayers CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol@v10.2.1/ol.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body
    class="bg-gray-50 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-200">
    <div class="h-screen flex flex-col">
      <!-- Header -->
      <header
        class="bg-primary dark:bg-gray-800 text-white shadow-2xl flex-shrink-0">
        <div
          class="container mx-auto px-6 pt-4 pb-5 flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold tracking-tight">GuideTrackee Routes</h1>
            <p class="text-sm text-orange-100 dark:text-gray-400 mt-1">
              City Walking Tours - Routing System
            </p>
          </div>
          <!-- Theme Toggle -->
          <button
            id="theme-toggle"
            class="p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors"
            title="Przełącz tryb ciemny">
            <i id="theme-moon" data-lucide="moon" class="w-6 h-6"></i>
            <i id="theme-sun" data-lucide="sun" class="w-6 h-6 hidden"></i>
          </button>
        </div>
      </header>

      <!-- Main Content -->
      <main class="flex-1 flex flex-col lg:flex-row relative overflow-hidden">
        <!-- Left Side: Controls + Map -->
        <div class="flex-1 flex flex-col min-h-0">
          <!-- Controls Bar -->
          <div
            class="bg-white dark:bg-gray-800 shadow-md border-b border-gray-200 dark:border-gray-700 p-4 flex-shrink-0 transition-colors duration-200 safe-area-controls">
            <div class="flex flex-wrap items-center gap-3">
              <!-- City Selector -->
              <div class="flex items-center gap-2">
                <label
                  for="city-select"
                  class="text-sm font-semibold text-secondary dark:text-gray-300 flex items-center gap-1">
                  <i data-lucide="map-pin" class="w-4 h-4 text-primary"></i>
                  Miasto:
                </label>
                <select
                  id="city-select"
                  class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-white dark:bg-gray-700 dark:text-gray-100 shadow-sm transition-all">
                  <option value="krakow" selected>Kraków</option>
                  <option value="warszawa">Warszawa</option>
                  <option value="wroclaw">Wrocław</option>
                  <option value="trojmiasto">Trójmiasto</option>
                </select>
              </div>

              <!-- Profile Selector - US 8.2 -->
              <div class="flex items-center gap-2">
                <label
                  class="text-sm font-semibold text-secondary dark:text-gray-300 flex items-center gap-1">
                  <i data-lucide="route" class="w-4 h-4 text-primary"></i>
                  Profil:
                </label>
                <div
                  class="flex gap-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                  <button
                    id="profile-foot"
                    data-profile="foot"
                    class="profile-btn p-2 rounded-md transition-all flex items-center justify-center bg-primary text-white shadow-md"
                    title="Trasa piesza">
                    <i data-lucide="footprints" class="w-5 h-5"></i>
                  </button>
                  <button
                    id="profile-bicycle"
                    data-profile="bicycle"
                    class="profile-btn p-2 rounded-md transition-all flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"
                    title="Trasa rowerowa">
                    <i data-lucide="bike" class="w-5 h-5"></i>
                  </button>
                  <button
                    id="profile-car"
                    data-profile="car"
                    class="profile-btn p-2 rounded-md transition-all flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"
                    title="Trasa samochodowa">
                    <i data-lucide="car" class="w-5 h-5"></i>
                  </button>
                </div>
              </div>

              <!-- Search Bar - flex-1 to take remaining space -->
              <div class="flex-1 min-w-[200px] relative">
                <div class="relative">
                  <input
                    type="text"
                    id="search-input"
                    placeholder="Wyszukaj miejsce lub adres..."
                    class="w-full px-4 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-white dark:bg-gray-700 dark:text-gray-100 shadow-sm transition-all"
                    autocomplete="off" />
                  <i
                    data-lucide="search"
                    class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                </div>
                <!-- Autocomplete Results -->
                <div
                  id="search-results"
                  class="absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg hidden max-h-64 overflow-y-auto">
                  <!-- Results will be inserted here -->
                </div>
              </div>

              <!-- Clear All Button -->
              <button
                id="clear-all-btn"
                class="px-4 py-2 bg-secondary dark:bg-gray-700 text-white font-semibold rounded-lg hover:bg-secondary-light dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-secondary shadow-sm transition-all flex items-center gap-2">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
                <span class="hidden sm:inline">Wyczyść wszystko</span>
              </button>

              <!-- Sidebar Toggle Button (visible when route exists) -->
              <button
                id="sidebar-toggle-btn"
                class="px-4 py-2 bg-primary text-white font-semibold rounded-lg hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary shadow-sm transition-all flex items-center gap-2 hidden">
                <i data-lucide="panel-right" class="w-4 h-4"></i>
                <span class="hidden sm:inline">Instrukcje</span>
              </button>
            </div>
          </div>

          <!-- Error Notification -->
          <div class="px-4 pt-4">
            <div
              id="error-notification"
              class="bg-red-50 dark:bg-red-900/30 border-l-4 border-red-500 rounded-lg shadow-lg p-4 hidden">
              <div class="flex items-start">
                <div class="flex-shrink-0">
                  <i
                    data-lucide="alert-circle"
                    class="w-6 h-6 text-red-500"></i>
                </div>
                <div class="ml-3 flex-1">
                  <h3
                    class="text-sm font-semibold text-red-800 dark:text-red-300">
                    Błąd
                  </h3>
                  <p
                    id="error-message"
                    class="text-sm text-red-700 dark:text-red-400 mt-1"></p>
                </div>
                <button
                  id="close-error-btn"
                  class="ml-auto flex-shrink-0 text-red-500 hover:text-red-700 dark:hover:text-red-300 focus:outline-none">
                  <i data-lucide="x" class="w-5 h-5"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Map Container -->
          <div class="flex-1 min-h-0">
            <div class="h-full">
              <div id="map" class="w-full h-full"></div>
            </div>
          </div>
        </div>

        <!-- Right Sidebar: Route Info + Navigation + Export + Waypoints -->
        <div
          id="route-sidebar"
          class="w-[80vw] max-w-md bg-white dark:bg-gray-800 shadow-xl transform transition-transform duration-300 ease-in-out translate-x-full fixed right-0 top-0 h-full z-40 overflow-y-auto sidebar-safe">
          <!-- Sidebar Header -->
          <div
            class="sticky top-0 bg-gradient-to-r from-white to-orange-50 dark:from-gray-800 dark:to-gray-900 border-b-2 border-primary dark:border-primary-dark p-5 flex items-center justify-between z-10 shadow-sm safe-area-left safe-area-right">
            <h2
              class="text-xl font-bold text-secondary dark:text-gray-100 flex items-center gap-2">
              <i data-lucide="route" class="w-6 h-6 text-primary"></i>
              Trasa
            </h2>
            <button
              id="sidebar-close-btn"
              class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 focus:outline-none">
              <i data-lucide="x" class="w-6 h-6"></i>
            </button>
          </div>

          <!-- Sidebar Content -->
          <div class="p-4 space-y-4 safe-area-left safe-area-right">
            <!-- Waypoints List Panel -->
            <div id="waypoints-section">
              <h3
                class="text-lg font-bold text-secondary dark:text-gray-100 mb-3 flex items-center gap-2">
                <i data-lucide="map-pin" class="w-5 h-5 text-primary"></i>
                Punkty trasy
              </h3>
              <div id="waypoints-list" class="space-y-2">
                <!-- Waypoints will be inserted here -->
              </div>
              <p
                id="waypoints-empty"
                class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                Kliknij na mapę, aby dodać punkty trasy
              </p>
            </div>
            <!-- Route Info Panel -->
            <div id="route-info-section">
              <h3
                class="text-lg font-bold text-secondary dark:text-gray-100 mb-3 flex items-center gap-2">
                <i data-lucide="info" class="w-5 h-5 text-primary"></i>
                Informacje o trasie
              </h3>
              <div class="space-y-3">
                <div
                  class="flex items-center gap-3 bg-gradient-to-r from-orange-50 to-white dark:from-gray-700 dark:to-gray-800 p-4 rounded-lg border border-orange-100 dark:border-gray-600 shadow-sm">
                  <i data-lucide="ruler" class="w-5 h-5 text-primary"></i>
                  <div class="flex-1">
                    <span
                      class="text-sm text-secondary-light dark:text-gray-300 font-medium"
                      >Dystans:</span
                    >
                    <span
                      id="route-distance"
                      class="text-lg font-bold text-secondary dark:text-gray-100 ml-2"
                      >-</span
                    >
                  </div>
                </div>
                <div
                  class="flex items-center gap-3 bg-gradient-to-r from-orange-50 to-white dark:from-gray-700 dark:to-gray-800 p-4 rounded-lg border border-orange-100 dark:border-gray-600 shadow-sm">
                  <i data-lucide="clock" class="w-5 h-5 text-primary"></i>
                  <div class="flex-1">
                    <span
                      class="text-sm text-secondary-light dark:text-gray-300 font-medium"
                      >Czas:</span
                    >
                    <span
                      id="route-duration"
                      class="text-lg font-bold text-secondary dark:text-gray-100 ml-2"
                      >-</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Export Button -->
            <button
              id="export-geojson-btn"
              class="w-full px-5 py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary shadow-md transition-all disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              disabled>
              <i data-lucide="download" class="w-5 h-5"></i>
              Eksportuj GeoJSON
            </button>

            <!-- Export PDF Button -->
            <button
              id="export-pdf-btn"
              class="w-full px-5 py-3 bg-secondary text-white font-bold rounded-lg hover:bg-secondary-light focus:outline-none focus:ring-2 focus:ring-secondary shadow-md transition-all disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              disabled>
              <i data-lucide="file-text" class="w-5 h-5"></i>
              Eksportuj wskazówki PDF
            </button>

            <!-- Navigation Instructions -->
            <div id="nav-instructions-section">
              <h3
                class="text-lg font-bold text-secondary dark:text-gray-100 mb-3 flex items-center gap-2">
                <i data-lucide="navigation" class="w-5 h-5 text-primary"></i>
                Instrukcje nawigacji
              </h3>
              <div
                id="nav-instructions-list"
                class="space-y-2 max-h-[500px] overflow-y-auto">
                <!-- Instructions will be inserted here -->
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar Overlay (backdrop) -->
        <div
          id="sidebar-overlay"
          class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>
      </main>

      <!-- Footer -->
      <footer
        class="bg-secondary dark:bg-gray-900 text-gray-300 dark:text-gray-400 flex-shrink-0 shadow-inner border-t border-gray-700 dark:border-gray-800">
        <div class="container mx-auto px-4 py-4 text-center text-sm">
          <p class="font-medium">
            Powered by OSRM & OpenStreetMap | &copy; 2025 WTG Route Machine
          </p>
        </div>
      </footer>
    </div>

    <!-- OpenLayers JS -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.2.1/dist/ol.js"></script>

    <!-- Custom JS -->
    <script src="js/config.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/geocoding.js"></script>
    <script src="js/routing.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/map.js"></script>

    <!-- Capacitor Mobile Support -->
    <script type="module">
      // Initialize Capacitor plugins for mobile
      if (window.Capacitor) {
        const { StatusBar, Style } = window.Capacitor.Plugins;

        // Configure status bar
        if (StatusBar) {
          // Set status bar style based on theme
          const isDark = document.documentElement.classList.contains('dark');
          StatusBar.setStyle({ style: isDark ? Style.Dark : Style.Light });

          // Make status bar overlay content (transparent background)
          StatusBar.setOverlaysWebView({ overlay: true });

          // Listen for theme changes
          const observer = new MutationObserver(() => {
            const isDark = document.documentElement.classList.contains('dark');
            StatusBar.setStyle({ style: isDark ? Style.Dark : Style.Light });
          });
          observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['class'],
          });
        }
      }
    </script>

    <!-- Initialize Lucide Icons -->
    <script>
      lucide.createIcons();
    </script>
  </body>
</html>
